---
layout: post
title:  "SRE本読み始めました。"
date:   2020-04-19 23:50
categories: jekyll update
---

こんばんは。ここ最近積読がやばくなってきたというのと、アウトプットの場を作りたいという気持ちで、GithubPageで日記をつけていこうと考え始めました。ほぼ個人的なメモになると思う。
ということで、以前からずっと読みたいと思っていた[SREサイトリアイアビリティエンジニアリング]を読み始めた。

---

## はじめに
SREはシステムの信頼性に焦点を置く。信頼性こそがあらゆるプロダクトの機能であると。
SREはスケーラビリティ、信頼性、効率性を向上させるために、設計と運用の改善点を見つけることに集中する。

最初のSREはMargalet Hamiltonらしい。調べたら昔Twitterで見かけた写真の人物だった。
その写真は、Margalet Hamiltonが自身の身長ほどの高さに積み上げられた、印刷されたソースコードの横に並んで笑顔で映っていた。
これ以降は、彼女は宇宙飛行士が間違ってP01キーを押した場合でも、無事に帰還できるような安全策を書いたみたいな話が続く。

最後に、以下のSRE的なやり方を心に留めておく必要があると。
```
徹底と献身、準備とドキュメンテーションの価値を信じること。起こりうる何かを避けようとする強い意志を認識すること。
```

ちなみに本の読み方としては、好きな順序(章)で読めるようになっているらしい。
最初は2章3章から読み進めるのが良いと書いてあるので、2章から読んでいく。

---

## 2章 SREの観点から見たGoogleのプロダクション環境
### 2-1 ハードウェア
Googleのデータセンタは、独自の電源系、冷却系、ネットワーク、コンピュートハードウェアを持っているらしい。
例えばGmailなどのサービスを動かす際のサーバは、このサーバで動かす！みたいに決まっているわけではなく、クラスタオペレーティングシステムのBorgが割り当てを行っている。
(以前私がKubernetesに調べた際に少し出てきたのを覚えている。KubernetesはBorgの子孫らしい。)

データセンタ内のマシン群を互いに通信させるために、数万ポートを持つ高速な仮想スイッチを開発したらしい。
この仮想スイッチはJupiterと呼ばれるClosネットワーク装置で、サーバ間の速度は1.3Pbpsのバイセクション帯域幅をサポートする。
- Jupiter: Googleのデータセンタで使用されるネットワーク技術。
  - https://www.school.ctc-g.co.jp/columns/nakai2/nakai214.html
  - https://research.google/pubs/pub43837/
- Clos: データセンタネットワークで使われる技術。スケールアウトが容易なLeaf-SpineアーキテクチャをL3で構築する。(よくわからないので以下のurlをそのまま書いた。別の機会に調べる。)
  - https://www.apresiatac.jp/blog/20190311992/
- バイセクション帯域幅: ネットワークに接続されているコンピュータをに分割した時に、二分割間の通信帯域幅のこと。
  - http://www.ssken.gr.jp/MAINSITE/download/newsletter/2001/sci/2/doc2/03.html

---

## 2-2-1 マシン群の管理
Borgは分散クラスタオペレーティングシステム。ジョブをクラスタレベルで管理する。って言われてもよくわからない。
簡単に言うと、数万・数十万のジョブをBorgが一回受け入れて、タスク動かすマシンを選定してそこで実行させる。そのあとは継続的にそのタスクを監視し、問題などが発生すればkillされ再起動される。再起動後は別のマシンで実行されることもあるとか。

Borgで面白かったのがBNS(Borg Naming Service)といったもの。
Borgではタスクが流動的に割り当てられる(色々なマシンで)のでIPアドレスとポート番号じゃ管理できないっていうことで間接参照できるようにしたものがBNS。
Borgはジョブの開始時に、タスクに名前とインデックス番号を割り当てる。タスクに接続する際は、BNS名を使用する。
```
BNS名⇔IPアドレス・ポート番号
/bns/<クラスタ>/<ユーザ>/<ジョブ名>/<タスク番号> ⇔ <IPアドレス>:<ポート番号>
```

Borgはリソース割り当てを行い、最適な方法でタスクをマシンに配置する。
ラックのToRスイッチが単一障害点になるため、一つのジョブの全タスクを同じラック上では動作させない。
ちなみに、タスクが割り当てたリソース以上使おうとすると、そのタスクをKillするらしい。
理由としては、まったく再起動されないタスクよりも、ゆっくりとクラッシュを繰り替えすタスクのほうが好ましいから。(ゆっくりとクラッシュを繰り返すのもどうなのかなぁ～という感想。。。君ならどうする？と言われたら分からないけど)

- Torスイッチ: データセンタネットワーク設計の一種


今日はここまで。
まだちょっとしか読めていないけど、知らないことが多くて読んでいてすごい楽しい。
ただ、SREの本質にはまだ触れてなくてGoogleさんスゲーが続いている。
継続して読んでいきたいね。

[SREサイトリアイアビリティエンジニアリング]: https://www.oreilly.co.jp/books/9784873117911/